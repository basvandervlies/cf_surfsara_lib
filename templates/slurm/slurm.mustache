# slurm.conf file generated by CFEngine
#
# $Id: slurm.mustache 26751 2018-09-04 13:30:08Z martijk $
# $URL: https://subtrac.surfsara.nl/osd/beowulf/svn/trunk/cfengine3/templates/slurm/slurm.mustache $
#
# See the slurm.conf man page for more information.
#
ClusterName={{{vars.sara_data.slurm.ClusterName}}}
ControlMachine={{{vars.sara_data.slurm.ControlMachine}}}
#
SlurmUser={{{vars.sara_data.slurm.SlurmUser}}}
SlurmctldPort={{{vars.sara_data.slurm.SlurmctldPort}}}
SlurmdPort={{{vars.sara_data.slurm.SlurmdPort}}}

AuthType={{{vars.sara_data.slurm.AuthType}}}

SwitchType=switch/none
MpiDefault={{{vars.sara_data.slurm.MpiDefault}}}

StateSaveLocation={{{vars.slurm.spool_dir}}}/checkpoint
SlurmdSpoolDir={{{vars.slurm.spool_dir}}}/slurmd

SlurmctldLogFile={{{vars.slurm.log_dir}}}/slurmctld.log
SlurmdLogFile={{{vars.slurm.log_dir}}}/slurmd.log

SlurmctldPidFile={{{vars.slurm.pid_dir}}}/slurmctld.pid
SlurmdPidFile={{{vars.slurm.pid_dir}}}/slurmd.pid

PluginDir={{{vars.slurm.plugin_dir}}}
TmpFS={{{vars.sara_data.slurm.tmpfs}}}

#ProctrackType=proctrack/pgid
ProctrackType=proctrack/cgroup
CacheGroups=0
ReturnToService=1
#UnkillableStepTimeout=600
#UnkillableStepProgram="scontrol update NodeName=$(hostname -s) State=down Reason=hung_proc"
#
# Max settings
#
MaxJobCount=100000
MaxArraySize=1001

#
#
# TIMERS
InactiveLimit={{{vars.sara_data.slurm.InactiveLimit}}}
KillWait={{{vars.sara_data.slurm.KillWait}}}
MessageTimeout={{{vars.sara_data.slurm.MessageTimeout}}}
MinJobAge={{{vars.sara_data.slurm.MinJobAge}}}
SlurmctldTimeout={{{vars.sara_data.slurm.SlurmctldTimeout}}}
SlurmdTimeout={{{vars.sara_data.slurm.SlurmdTimeout}}}
WaitTime={{{vars.sara_data.slurm.WaitTime}}}
UnkillableStepTimeout={{{vars.sara_data.slurm.UnkillableStepTimeout}}}

## Sched section
{{#vars.sara_data.slurm.scheduling_section.comment}}
# {{{.}}}
{{/vars.sara_data.slurm.scheduling_section.comment}}
SchedulerParameters={{#vars.sara_data.slurm.scheduling_section.parameters}}{{{.}}},{{/vars.sara_data.slurm.scheduling_section.parameters}}
{{#vars.sara_data.slurm.scheduling_section.settings}}
{{{@}}}={{{.}}}
{{/vars.sara_data.slurm.scheduling_section.settings}}


# LOGGING
DebugFlags={{#vars.sara_data.slurm.DebugFlags}}{{{.}}},{{/vars.sara_data.slurm.DebugFlags}}
SlurmctldDebug={{{vars.sara_data.slurm.SlurmctldDebug}}}
SlurmdDebug={{{vars.sara_data.slurm.SlurmdDebug}}}
JobCompType=jobcomp/none
JobCompLoc=/tmp/slurm_job_completion.txt
#
# ACCOUNTING
JobAcctGatherType=jobacct_gather/linux
JobAcctGatherFrequency=30
JobAcctGatherParams=UsePss
#
AccountingStorageEnforce=limits,associations,qos
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageTRES={{{vars.sara_data.slurm.AccountingStorageTRES}}}
AccountingStorageHost={{{vars.sara_data.slurm.AccountingStorageHost}}}
AccountingStorageLoc=slurm_acct_db
#AccountingStoragePass=slurmtestdb
AccountingStorageUser=slurm
GresTypes={{{vars.sara_data.slurm.GresTypes}}}
#
# COMPUTE NODES
# control node

## Plugins
TopologyPlugin=topology/tree

# SURFsara
MailProg=/usr/bin/mail

# Priority
{{#vars.sara_data.slurm.priority_section}}
{{{@}}}={{{.}}}
{{/vars.sara_data.slurm.priority_section}}
#
# Cgroups
TaskPlugin=task/affinity,task/cgroup

# Prolog and Epilog scripts
Epilog={{{vars.sara_data.slurm.Epilog}}}
Prolog={{{vars.sara_data.slurm.Prolog}}}
PrologEpilogTimeout={{{vars.sara_data.slurm.PrologEpilogTimeout}}}
PrologFlags={{{vars.sara_data.slurm.PrologFlags}}}
PrologSlurmctld={{{vars.sara_data.slurm.PrologSlurmctld}}}


# NHC health check
{{#vars.sara_data.slurm.health_section}}
{{{@}}}={{{.}}}
{{/vars.sara_data.slurm.health_section}}

# Reboot
RebootProgram=/sbin/reboot
ResumeTimeout={{{vars.sara_data.slurm.ResumeTimeout}}}

# No default section hold keywords that do nt have a default value
{{#vars.sara_data.slurm.no_default_section}}
{{{@}}}={{{.}}}
{{/vars.sara_data.slurm.no_default_section}}

Include nodes.conf
# Include section
{{#vars.sara_data.slurm.include_files}}
Include {{{.}}}
{{/vars.sara_data.slurm.include_files}}

# PARTITIONS
EnforcePartLimits=ALL
{{#vars.sara_data.slurm.partition_section}}
PartitionName={{{name}}} {{#settings}}{{{@}}}={{{.}}} {{/settings}}
{{/vars.sara_data.slurm.partition_section}}


# Licenses
Licenses={{#vars.sara_data.slurm.licenses_section}}{{{.}}},{{/vars.sara_data.slurm.licenses_section}}
